: LS dir cls drop dup $00 > if $01 do $08 $04 at . $01 $04 at . $04 $04 at . $23 $04 at accept drop scroll loop then nop ;
: ED dup v0! open $01 do i v0@ record cls . edc loop ;
: EDE storepage ptr $02 + cls dedit filepage bupd ;
: EDC waitk $65 = if ede then ;
: CVOL $90 + + note ;
: CNOTE $80 + + note ;
: CHD $60 ;
: CHC $40 ;
: CHB $20 ;
: CHA $00 ;
: SILENT $9f note $bf note $df note $ff note ;
: SOUND $01 cartdev $00 spitime ! ;
: NOTE spicel spio spiceh spicel ;
: TUNEMS $90 note $80 note playms ;
: PLAYMS count $00 do ptr i + @ anote $ff pausems loop ;
: TUNE $90 note $80 note play ;
: BNOTE dup $20 = not if $61 - note ;
: PLAY count $00 do ptr i + @ anote $01 pause loop ;
: ANOTE $61 - note ;
: CHDL $ff note ;
: CHCL $df note ;
: CHBL $bf note ;
: CHAL $9f note ;
: CHDH $f0 note ;
: CHCH $d0 note ;
: CHBH $b0 note ;
: CHAH $90 note ;
: CPLAY ptr repeat dup cpa $01 + dup cpb $01 + $ff pausems cpe until ;
: CPE dup @ $00 = not ;
: CPB dup @ chbh anote @ $20 = if chbl then ;
: CPA dup @ chah anote @ $20 = if chal then ;
: INDUR $06 scratch ;
: ICAD $02 scratch ;
: ICAN $00 scratch ;
: IBGI icbn 2@ @ icbn 1+2! ;
: IAGI ican 2@ @ ican 1+2! ;
: ICHBN ibgi $8f note anote $90 note ibgi $30 - icbd ! ;
: ICHAN iagi $8f note anote $90 note iagi $30 - icad ! ;
: ICHAP icad 1-! icad @ 0= if ichan then ;
: SETCHANB ptr icbn ! $01 icbd ! $ff indur ! ;
: SETCHANA ptr ican 2! $01 icad ! $ff indur ! ;
: IPLAYAB repeat ichap ichbp indur @ pausems ican 2@ @ 0= not until ;
: ICHNP icnd 1-! icnd @ 0= if ichbn then ;
: IPLAYA repeat ichap indur @ pausems ican 2@ @ 0= not until ;
: PICONET $01 cartdev $30 spitime ! ;
: NODECLR spiceh spicel $15 spio ;
: GETNODE spicel $18 spio spii nop spiceh ;
: SPIGETC spicel $11 spio spii spiceh ;
: SENDNODE v0! count spiceh $00 do dup i + @ v0@ spicel $10 spio spio spio spiceh $01 pause loop ;
: SPIPUTB spicel $10 spio spio spio spiceh ;
: SPIPUTC spicel $10 spio spio ptr @ spio spiceh ;
: SPITYPE spiceh $00 do dup i + @ v0@ spicel $10 spio spio spio spiceh $01 pause loop ;
: SPISTRZ ptr count $00 do dup i + @ spio $01 pause loop ;
: SOCCON spicel $22 spio spistrz ;
: SOCTYPE spiceh spicel $00 do dup i + @ $20 spio spio loop ;
: UBACK $01 do list count soctype loop ;
: MORE cls repeat scroll $01 $04 at depth . $0a $04 at .> $01 $01 at accept drop depth 0= not until nop ;
: BPOFF $01 bp ;
: BPON $00 bp ;
: LREAD read repeat readcont if read concat then readcont until nop ;
: CLRSTK depth ?dup if $01 do drop loop then nop ;
: TYPE $00 do dup i + @ emit loop ;
: STRNCPY $00 scratch 2! $02 scratch 2! do $00 scratch 2@ i + @ $02 scratch 2@ i + ! loop nop  ;
: UBACKI $01 do cls ptr type waitk $79 = if list count soctype $00 then drop loop ;
: UBI $01 do cls ptr count type waitk $79 = if list count soctype $00 then drop loop ;
: UBIB $01 do cls ptr count type waitk $79 = if list count soctype drop $00 then drop loop ;
: UBIC $01 do cls ptr count type waitk $79 = if list count soctype drop then drop loop ;
: UBID $01 do cls ptr count type waitk $79 = if list count soctype drop then 2drop loop ;
: UBIALL $01 do cls ptr count type list cr concat count soctype 2drop loop ;
: UBIE $01 do cls ptr count type waitk $79 = if list cr concat count soctype drop then 2drop loop ;

